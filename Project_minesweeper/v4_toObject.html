<!DOCTYPE html>
<!-- saved from url=(0080)https://alaamarawi.github.io/AdvancedProgramming_javascript//CW9/MyGraphics.html -->
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta name="viewport" content="width=device-width">
  <title>SVG and Canvas </title>

  <style>
  svg{
    background: purple;
    font: 15px arial, sans-serif;
  }
  .unoppened {
    // border-radius: 10%;

    filter: url(#unopenedSquare);
    // stroke: pink;
    // background-image: url(unopenedSquare.png);
    // background-size: contain;
    // background-position: center;
    background-repeat: no-repeat;
    // padding: 80px;
    background-size: 100% ;
    //height: 23em;
    position:  absolute;
    //width: 23em; 
    //border: 1px solid yellow;
    //  margin: 5%;
  }
</style>
</head>

<body>
  <h2>My Minesweeper</h2>

  <svg id="mySVG" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" oncontextmenu="return false">

    <rect x="15" y="10" width="100" height="60" style="fill:pink;stroke:black;stroke-width:5"></rect>
    <text x="35" y="50" fill="black">Mines : 10</text>
    <filter id="unopenedSquare" x="0%" y="0%" width="100%" height="100%">
      <feImage xlink:href="unopenedSquare.png"/>
    </filter>
    <filter id="openedSquare" x="0%" y="0%" width="100%" height="100%">
      <feImage xlink:href="openedSquare.png"/>
    </filter>
    <filter id="mine" x="0%" y="0%" width="100%" height="100%">
      <feImage xlink:href="mine.png"/>
    </filter>
    <filter id="flage" x="0%" y="0%" width="100%" height="100%">
      <feImage xlink:href="flag.png"/>
    </filter>
    <filter id="1" x="0%" y="0%" width="100%" height="100%">
      <feImage xlink:href="1.png"/>
    </filter>
    <filter id="2" x="0%" y="0%" width="100%" height="100%">
      <feImage xlink:href="2.png"/>
    </filter>
    <filter id="3" x="0%" y="0%" width="100%" height="100%">
      <feImage xlink:href="3.png"/>
    </filter>
    <filter id="4" x="0%" y="0%" width="100%" height="100%">
      <feImage xlink:href="4.png"/>
    </filter>
    <filter id="5" x="0%" y="0%" width="100%" height="100%">
      <feImage xlink:href="5.png"/>
    </filter>
    <filter id="6" x="0%" y="0%" width="100%" height="100%">
      <feImage xlink:href="6.png"/>
    </filter>
    <filter id="7" x="0%" y="0%" width="100%" height="100%">
      <feImage xlink:href="7.png"/>
    </filter>
    <filter id="8" x="0%" y="0%" width="100%" height="100%">
      <feImage xlink:href="8.png"/>
    </filter>        
  </svg>

  <br>

  <p>Ref: <i>Eloquent JavaScript</i>,
    <a href="http://eloquentjavascript.net/17_canvas.html" target="ExternalDocument"> Chap 17</a>
  </p>

  <script>

    "use strict";

/*
<image xlink:href="wall.jpg" x="0" y="0" width="100" height="100" />

<svg id="svg" width="500" height="400">
  <circle cx="50" cy="50" r="40" style="fill:pink;stroke:blue;stroke-width:4"></circle>
  <text x="35" y="55" fill="black">Circle</text>
  <rect x="110" y="10" width="80" height="80" style="fill:pink;stroke:red;stroke-width:5"></rect>
  <rect x="190" y="10" width="80" height="80" style="fill:pink;stroke:red;stroke-width:5"></rect>
</svg>
var svg = document.createElement('SVG');
    svg.setAttribute('style', 'border: 1px solid black');
    svg.setAttribute('width', '600');
    svg.setAttribute('height', '250');
    svg.setAttribute('version', '1.1');
    svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
document.body.appendChild(svg);
//_______________
 
var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
svg.setAttribute('style', 'border: 5px solid red');
svg.setAttribute('width', '200');
svg.setAttribute('height', '200');
svg.setAttribute('id', 'svg');

let svg1 = document.getElementById("svg");
//svg.setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns:xlink", "http://www.w3.org/1999/xlink");
document.body.appendChild(svg);

class Tile {
constructor (){
  this.isMine=false;
  this.isRevealed=false;
 }
}
*/
function createCircle()
{
    var myCircle = document.createElementNS(svgNS,"circle"); //to create a circle. for rectangle use "rectangle"
    myCircle.setAttributeNS(null,"id","mycircle");
    myCircle.setAttributeNS(null,"cx",100);
    myCircle.setAttributeNS(null,"cy",100);
    myCircle.setAttributeNS(null,"r",50);
    myCircle.setAttributeNS(null,"fill","black");
    myCircle.setAttributeNS(null,"stroke","none");

    document.getElementById("mySVG").appendChild(myCircle);
  }    
  var myTile;
  function createTile(x,y,w,h)
  {
    myTile= document.createElementNS(svgNS,"rect");
    //myTile.setAttribute("id",i+""+j); // tile id = ij (its location in the array)
    myTile.setAttribute("x",x);
    myTile.setAttribute("y",y);
    myTile.setAttribute("width",w);
    myTile.setAttribute("height",h);
    //myTile.setAttribute('stroke-width', '3px');
    //myTile.setAttribute('stroke', 'red');
  //myTile.setAttributeNS(null,"fill","black");
  //myTile.setAttribute('fill','black');
  myTile.setAttribute('class','unoppened');
    //myTile.setAttribute('filter','url(#unopenedSquare)');
    myTile.setAttribute('onmousedown', 'click(this,evt)');
    document.getElementById("mySVG").appendChild(myTile);
  } 
 function drawMyGrid(){ // draw the grid and fill the a2D array
  for(let i=0; i<iTiles;i++ ){  
    tileMap[i]=[];
    for ( let j = 0; j < jTiles; j++) {
      createTile(xTile,yTile,widthTile,heightTile);
      myTile.isMine=false;
      myTile.isRevealed=false;
      myTile.hasFlag=false;
      myTile.xLoc=i; // x location
      myTile.yLoc=j; // y location
      tileMap[i][j]=myTile;
      xTile+=(widthTile);
    }
    yTile+=(heightTile);
    xTile=15;
  }
}
var clickedTile={}; 
function click(element,evt){
  //clickedTile=tileMap[element.id[0]][element.id[1]];
  clickedTile=tileMap[element.xLoc][element.yLoc];
  if(clickedTile.isRevealed)return;
  console.log(element.xLoc+","+element.yLoc+" clicked"); //tile location x,y
  if (evt.which==1){
    reveal(clickedTile);
  }else if (evt.which==3){
    
    if (clickedTile.hasFlag){ //if its object in array is flaged.. 
      unFlage(element);
      clickedTile.hasFlag=false;
      flagCount--;
    }else{
      putFlage(element);
      clickedTile.hasFlag=true;
      flagCount++;
      if(flagCount==mineCount){
        if(revealedTileCount==(iTiles*jTiles)-flagCount){ // if all tiles except mines are revealed:
          consol.log("you Won");
        }
      }
    }
  }


}
function reveal(tile){
  revealedTileCount++;
  tile.isRevealed=true;
  mineCount=0;
  if (tile.isMine){
    explode(tile);
    //game over ...
      //return;
    }else{

      seeNeighbors(tile.xLoc,tile.yLoc); // see n.s of this x,y tile
  // ......
  //tile.style.filter= 'url(#openedSquare)';

}  

}
function putFlage(element){
  element.style.filter= 'url(#flage)';
}
function unFlage(element){
 element.style.filter= 'url(#unopenedSquare)';
}

function explode(element){
 element.style.filter= 'url(#mine)';
}
function randomMines(){

  var ri;
  var rj;
  for (let i = 0; i < mines; i++) {
    ri =Math.floor(Math.random() * iTiles); 
    rj =Math.floor(Math.random() * jTiles); 
    console.log(ri+" "+rj);
    if(tileMap[ri][rj].isMine){ 
      i--;
      continue ;
    }
    tileMap[ri][rj].isMine=true;
  }
}
let mineCount;
function seeNeighbors(x,y){
 // console.log(tileMap[x][y]);
  mineCount=0;
  for (let i = x - 1; i <= x + 1; i++) {
            for (let j = y - 1; j < y + 2; j++) { 
             if (i == x && j == y) {
                    continue;
                  }
                  try {
                    if (tileMap[i][j].isMine) {
                      //console.log("it is a mine! : i,j "+i+","+j);
                      mineCount++;
                    }
                  } catch (err) {
                    continue;
                 }
               }
             }
             console.log("neighbor mine count: "+mineCount);
             labelCounter(tileMap[x][y],mineCount);
             if(mineCount==0){
                for (let i = x - 1; i < x + 2; i++) {
                  for (let j = y - 1; j < y + 2; j++) {
                    if (i < 0 || j < 0) {
                        continue;
                    }
                    try {
                        if (!tileMap[i][j].isRevealed && !tileMap[i][j].hasFlag) {
                            reveal(tileMap[i][j]);
                        }
                    } catch (err) {
                        continue;
                    }
                  }
                } 
             }

     }
function labelCounter(tile,mineCount){
  console.log("revealed: "+tile.xLoc+","+tile.yLoc);
  if(mineCount==0){
    tile.style.filter= 'url(#openedSquare)';
  }else if(mineCount<9){
    tile.style.filter= 'url(#'+mineCount+')';
  }else{
    console.log("Error! neighbors' mineCount cannot be more than 8");
  };
           

}

          function tmp(element,evt){
            console.log(element);
            if (evt.which ==3){
             console.log("right button clicked"); 
           }else if (evt.which ==1){
            console.log(evt);
          }
        }


//createCircle();
var svgNS = "http://www.w3.org/2000/svg";  
let mysvg = document.getElementById("mySVG");
mysvg.setAttribute('width', '600');
mysvg.setAttribute('height', '600');
//let i=0;
//let j=0;
let xTile=15; //starting x location of the tile
let yTile=100; // starting y location of the tile
let widthTile=50; // width of tile
let heightTile=50; // height of tile
let iTiles =9; // # of tiles in line
let jTiles =9; // # of tiles in row
let tileMap=[];
var flagCount=0;
var revealedTileCount=0;
var mines=10;
drawMyGrid(); // draw the grid and fill 2D array
randomMines(); // put mines
//click(tileMap[0][0].tile);
//explode(tileMap[1][1].tile);
 /*
 for (var i = 0; i <9; i++) {
  for (var j = 0; j <9; j++) {
    reveal(tileMap[i][j]);
  }
}
*/

</script>



</body>
</html>